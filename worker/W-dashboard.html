<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hirewale Â· Worker Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --brand-600: #0ea5e9;
      --brand-700: #0284c7;
      --brand-success: #10b981;
      --brand-warning: #f59e0b;
      --brand-danger: #ef4444;
      --brand-info: #3b82f6;
      --ink: #0f172a;
      --card-bg: #ffffff;
      --glass-bg: rgba(255, 255, 255, 0.85);
      --glass-border: rgba(0, 0, 0, 0.08);
      --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      --transition-speed: 0.3s;
      --sidebar-width: 240px;
      --header-height: 70px;
      --nav-height: 60px;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
    
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      color: var(--ink);
      display: flex;
      flex-direction: column;
    }
    
    /* Header */
    .dashboard-header {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--glass-border);
      padding: 0 24px;
      height: var(--header-height);
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 700;
      font-size: 22px;
      background: linear-gradient(135deg, var(--brand-600), var(--brand-700));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .logo i {
      font-size: 26px;
      background: linear-gradient(135deg, var(--brand-600), var(--brand-700));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    /* Main Content Layout */
    .dashboard-container {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      padding: 24px;
    }
    
    /* Profile Header */
    .profile-header {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .profile-info {
      display: flex;
      align-items: center;
      gap: 20px;
      flex: 1;
    }
    
    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid var(--brand-600);
      overflow: hidden;
      position: relative;
      box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
    }
    
    .profile-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .profile-details {
      flex: 1;
    }
    
    .profile-name {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .profile-badge {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    
    .profile-service {
      color: var(--brand-600);
      font-weight: 600;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .profile-meta {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }
    
    .meta-item {
      display: flex;
      align-items: center;
      gap: 6px;
      color: #64748b;
      font-size: 14px;
    }
    
    .meta-item i {
      color: var(--brand-600);
    }
    
    .profile-stats {
      display: flex;
      gap: 20px;
      margin-top: 12px;
    }
    
    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px 16px;
      background: #f1f5f9;
      border-radius: 12px;
      min-width: 80px;
    }
    
    .stat-value {
      font-weight: 700;
      font-size: 20px;
      color: var(--ink);
    }
    
    .stat-label {
      font-size: 12px;
      color: #64748b;
    }
    
    .profile-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    /* Action Buttons */
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--brand-600), var(--brand-700));
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(14, 165, 233, 0.4);
    }
    
    .btn-success {
      background: var(--brand-success);
      color: white;
    }
    
    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }
    
    .btn-danger {
      background: var(--brand-danger);
      color: white;
    }
    
    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid var(--brand-600);
      color: var(--brand-600);
    }
    
    .btn-outline:hover {
      background: var(--brand-600);
      color: white;
      transform: translateY(-2px);
    }
    
    .btn-sm {
      padding: 6px 12px;
      font-size: 12px;
    }
    
    .btn-icon {
      width: 36px;
      height: 36px;
      padding: 0;
      justify-content: center;
      border-radius: 50%;
    }
    
    /* Availability Toggle */
    .availability-toggle {
      position: relative;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 30px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--brand-danger);
      transition: .4s;
      border-radius: 34px;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 22px;
      width: 22px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .toggle-slider {
      background-color: var(--brand-success);
    }
    
    input:checked + .toggle-slider:before {
      transform: translateX(30px);
    }
    
    .toggle-label {
      font-weight: 600;
      font-size: 14px;
      color: var(--ink);
    }
    
    /* Job Area */
    .job-area {
      display: flex;
      gap: 24px;
      flex: 1;
      min-height: 0;
    }
    
    @media (max-width: 1024px) {
      .job-area {
        flex-direction: column;
      }
    }
    
    .job-column {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
      overflow: hidden;
    }
    
    .job-column-header {
      padding: 20px;
      border-bottom: 1px solid var(--glass-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .job-column-header h2 {
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .job-count {
      background: var(--brand-600);
      color: white;
      border-radius: 20px;
      padding: 4px 12px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .job-list {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    /* Job Cards */
    .job-card {
      background: white;
      border-radius: 16px;
      padding: 20px;
      border: 1px solid #e2e8f0;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .job-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      border-color: var(--brand-600);
    }
    
    .job-card.assigned {
      border-left: 4px solid var(--brand-600);
      background: linear-gradient(135deg, #f8fafc, #f0f9ff);
    }
    
    .job-card.in-progress {
      border-left: 4px solid var(--brand-warning);
      background: linear-gradient(135deg, #fffbeb, #fef3c7);
    }
    
    .job-card.completed {
      border-left: 4px solid var(--brand-success);
      background: linear-gradient(135deg, #f0fdf4, #dcfce7);
    }
    
    .job-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }
    
    .job-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .job-client {
      font-size: 14px;
      color: #64748b;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .job-status {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      white-space: nowrap;
    }
    
    .status-pending {
      background: #fef3c7;
      color: #92400e;
    }
    
    .status-assigned {
      background: #e0f2fe;
      color: #075985;
    }
    
    .status-in-progress {
      background: #fef3c7;
      color: #92400e;
    }
    
    .status-completed {
      background: #dcfce7;
      color: #166534;
    }
    
    .job-details {
      margin: 16px 0;
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
    }
    
    .detail-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: #475569;
    }
    
    .detail-item i {
      color: var(--brand-600);
      width: 16px;
    }
    
    .job-actions {
      display: flex;
      gap: 8px;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    
    .job-actions .btn {
      flex: 1;
      min-width: 120px;
      justify-content: center;
    }
    
    .job-actions .btn-icon {
      flex: 0 0 auto;
    }
    
    /* Notification Card */
    .notification-card {
      background: white;
      border-radius: 16px;
      padding: 20px;
      border: 1px solid #e2e8f0;
      border-left: 4px solid var(--brand-info);
      animation: slideIn 0.4s ease;
      transition: all 0.3s ease;
    }
    
    .notification-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }
    
    .notification-card.urgent {
      border-left-color: var(--brand-danger);
      background: linear-gradient(135deg, #fef2f2, #fee2e2);
    }
    
    .notification-card.appointment {
      border-left-color: var(--brand-warning);
      background: linear-gradient(135deg, #fffbeb, #fef3c7);
    }
    
    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }
    
    .notification-time {
      font-size: 12px;
      color: #64748b;
      white-space: nowrap;
    }
    
    .notification-actions {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }
    
    .notification-actions .btn {
      flex: 1;
      justify-content: center;
    }
    
    /* Empty States */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #94a3b8;
    }
    
    .empty-state i {
      font-size: 48px;
      margin-bottom: 16px;
      color: #cbd5e1;
    }
    
    .empty-state h3 {
      font-size: 18px;
      margin-bottom: 8px;
      color: #64748b;
    }
    
    .empty-state p {
      font-size: 14px;
      max-width: 300px;
      margin: 0 auto;
    }
    
    /* Active Job Banner */
    .active-job-banner {
      background: linear-gradient(135deg, var(--brand-600), var(--brand-700));
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      animation: slideDown 0.5s ease;
      box-shadow: 0 4px 20px rgba(14, 165, 233, 0.3);
    }
    
    .active-job-info {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .active-job-icon {
      font-size: 24px;
      background: rgba(255, 255, 255, 0.2);
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .active-job-details h3 {
      font-size: 16px;
      margin-bottom: 4px;
    }
    
    .active-job-details p {
      font-size: 14px;
      opacity: 0.9;
    }
    
    /* Bottom Navigation */
    .bottom-nav {
      background: var(--glass-bg);
      backdrop-filter: blur(10px);
      border-top: 1px solid var(--glass-border);
      height: var(--nav-height);
      display: flex;
      justify-content: space-around;
      align-items: center;
      position: sticky;
      bottom: 0;
      z-index: 100;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.05);
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      color: #64748b;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 12px;
      transition: all 0.3s ease;
      flex: 1;
      max-width: 120px;
    }
    
    .nav-item:hover {
      color: var(--brand-600);
      background: #f1f5f9;
    }
    
    .nav-item.active {
      color: var(--brand-600);
      background: #f0f9ff;
    }
    
    .nav-item i {
      font-size: 20px;
    }
    
    .nav-item span {
      font-size: 12px;
      font-weight: 600;
    }
    
    /* Modals */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      justify-content: center;
      align-items: center;
      z-index: 2000;
      backdrop-filter: blur(4px);
      animation: fadeIn 0.3s ease;
    }
    
    .modal-content {
      background: var(--glass-bg);
      backdrop-filter: blur(16px);
      border: 1px solid var(--glass-border);
      padding: 32px;
      border-radius: 20px;
      max-width: 800px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      animation: slideUp 0.3s ease;
      box-shadow: var(--glass-shadow);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .modal-header h2 {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 20px;
    }
    
    .close-modal {
      background: none;
      border: none;
      font-size: 24px;
      color: #64748b;
      cursor: pointer;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    
    .close-modal:hover {
      background: #f1f5f9;
      color: var(--brand-danger);
    }
    
    /* Enhanced Work Done Modal */
    .service-category {
      margin-bottom: 20px;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      overflow: hidden;
    }
    
    .category-header {
      background: linear-gradient(135deg, #f8fafc, #f0f9ff);
      padding: 16px;
      border-bottom: 1px solid #e2e8f0;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.3s ease;
    }
    
    .category-header:hover {
      background: linear-gradient(135deg, #f1f5f9, #e0f2fe);
    }
    
    .category-header h3 {
      font-size: 16px;
      font-weight: 600;
      color: var(--ink);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .category-icon {
      color: var(--brand-600);
    }
    
    .category-toggle {
      transition: transform 0.3s ease;
    }
    
    .category-toggle.collapsed {
      transform: rotate(-90deg);
    }
    
    .service-list {
      padding: 16px;
      background: white;
      max-height: 300px;
      overflow-y: auto;
      transition: all 0.3s ease;
    }
    
    .service-list.collapsed {
      max-height: 0;
      padding: 0 16px;
      overflow: hidden;
    }
    
    .service-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 1px solid #e2e8f0;
    }
    
    .service-item:hover {
      background: #f8fafc;
      border-color: var(--brand-600);
      transform: translateX(5px);
    }
    
    .service-item.selected {
      background: #f0f9ff;
      border-color: var(--brand-600);
      box-shadow: 0 2px 8px rgba(14, 165, 233, 0.2);
    }
    
    .service-checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    
    .service-info {
      flex: 1;
    }
    
    .service-name {
      font-weight: 500;
      color: var(--ink);
      margin-bottom: 2px;
    }
    
    .service-description {
      font-size: 12px;
      color: #64748b;
    }
    
    .service-price {
      font-weight: 600;
      color: var(--brand-600);
      white-space: nowrap;
    }
    
    .quantity-control {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .quantity-btn {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      border: 1px solid #e2e8f0;
      background: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }
    
    .quantity-btn:hover {
      border-color: var(--brand-600);
      color: var(--brand-600);
    }
    
    .quantity-input {
      width: 40px;
      text-align: center;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 2px;
      font-size: 14px;
    }
    
    .total-section {
      background: linear-gradient(135deg, #f8fafc, #f0f9ff);
      padding: 20px;
      border-radius: 12px;
      margin: 20px 0;
      border: 1px solid #e2e8f0;
    }
    
    .total-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 14px;
      color: #64748b;
    }
    
    .total-row.final {
      font-size: 18px;
      font-weight: 700;
      color: var(--ink);
      margin-top: 12px;
      padding-top: 12px;
      border-top: 2px solid #e2e8f0;
    }
    
    .total-amount {
      font-size: 24px;
      font-weight: 700;
      color: var(--brand-600);
    }
    
    .search-services {
      margin-bottom: 20px;
    }
    
    .search-input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    
    .search-input:focus {
      outline: none;
      border-color: var(--brand-600);
      box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.1);
    }
    
    .notes-section {
      margin: 20px 0;
    }
    
    .notes-section label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--ink);
    }
    
    .notes-section textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
      font-size: 14px;
    }
    
    .modal-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }
    
    .modal-actions .btn {
      flex: 1;
      justify-content: center;
    }
    
    /* Animations */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .dashboard-header {
        padding: 0 16px;
      }
      
      .main-content {
        padding: 16px;
      }
      
      .profile-header {
        flex-direction: column;
        align-items: stretch;
        padding: 20px;
      }
      
      .profile-info {
        flex-direction: column;
        text-align: center;
        gap: 16px;
      }
      
      .profile-stats {
        justify-content: center;
      }
      
      .profile-actions {
        flex-direction: column;
        width: 100%;
      }
      
      .profile-actions .btn {
        width: 100%;
        justify-content: center;
      }
      
      .job-area {
        gap: 16px;
      }
      
      .job-card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .job-actions .btn {
        min-width: 100%;
      }
      
      .modal-content {
        padding: 20px;
        width: 95%;
        max-width: 95%;
      }
      
      .service-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .quantity-control {
        align-self: flex-end;
      }
      
      .modal-actions {
        flex-direction: column;
      }
    }
    
    @media (max-width: 480px) {
      .profile-meta {
        flex-direction: column;
        gap: 8px;
      }
      
      .profile-stats {
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .bottom-nav span {
        display: none;
      }
      
      .nav-item {
        padding: 12px;
      }
      
      .nav-item i {
        font-size: 24px;
      }
      
      .service-list {
        max-height: 200px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="dashboard-header">
    <div class="logo">
      <i class="fas fa-hands-helping"></i>
      Hirewale Worker
    </div>
    <div class="current-time" id="currentTime">Loading...</div>
  </header>

  <!-- Main Content -->
  <div class="dashboard-container">
    <div class="main-content">
      <!-- Profile Header -->
      <div class="profile-header">
        <div class="profile-info">
          <div class="profile-avatar">
            <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80" alt="Worker Avatar">
          </div>
          <div class="profile-details">
            <div class="profile-name">
              Anil Sharma
              <span class="profile-badge">
                <i class="fas fa-crown"></i> Pro Elite
              </span>
            </div>
            <div class="profile-service">
              <i class="fas fa-faucet"></i> Master Plumber
            </div>
            <div class="profile-meta">
              <div class="meta-item">
                <i class="fas fa-map-marker-alt"></i>
                <span>Kasargod, Kerala</span>
              </div>
              <div class="meta-item">
                <i class="fas fa-star"></i>
                <span>4.8/5 (89 reviews)</span>
              </div>
              <div class="meta-item">
                <i class="fas fa-check-circle"></i>
                <span>48 jobs completed</span>
              </div>
            </div>
            <div class="profile-stats">
              <div class="stat-item">
                <div class="stat-value">â‚¹12,500</div>
                <div class="stat-label">Earnings</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">92%</div>
                <div class="stat-label">Success Rate</div>
              </div>
              <div class="stat-item">
                <div class="stat-value">12</div>
                <div class="stat-label">This Month</div>
              </div>
            </div>
          </div>
        </div>
        <div class="profile-actions">
          <div class="availability-toggle">
            <label class="toggle-switch">
              <input type="checkbox" id="availabilityToggle" checked>
              <span class="toggle-slider"></span>
            </label>
            <span class="toggle-label">Available for work</span>
          </div>
          <button class="btn btn-outline" id="viewProfileBtn">
            <i class="fas fa-user"></i> Profile
          </button>
          <button class="btn btn-danger btn-icon" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i>
          </button>
        </div>
      </div>

      <!-- Active Job Banner -->
      <div class="active-job-banner" id="activeJobBanner" style="display: none;">
        <div class="active-job-info">
          <div class="active-job-icon">
            <i class="fas fa-tools"></i>
          </div>
          <div class="active-job-details">
            <h3>You have an active job</h3>
            <p>Complete or cancel your current job before taking another assignment</p>
          </div>
        </div>
        <button class="btn btn-outline" id="viewActiveJobBtn" style="color: white; border-color: white;">
          View Job
        </button>
      </div>

      <!-- Job Area -->
      <div class="job-area">
        <!-- Upcoming Jobs Column -->
        <div class="job-column">
          <div class="job-column-header">
            <h2><i class="fas fa-calendar-alt"></i> Upcoming Jobs</h2>
            <span class="job-count" id="upcomingJobsCount">0</span>
          </div>
          <div class="job-list" id="upcomingJobsList">
            <!-- Jobs will be populated here -->
          </div>
        </div>

        <!-- Job Notifications Column -->
        <div class="job-column">
          <div class="job-column-header">
            <h2><i class="fas fa-bell"></i> Job Notifications</h2>
            <span class="job-count" id="notificationsCount">0</span>
          </div>
          <div class="job-list" id="notificationsList">
            <!-- Notifications will be populated here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <a href="#" class="nav-item active">
      <i class="fas fa-home"></i>
      <span>Home</span>
    </a>
    <a href="W-withdraw.html" class="nav-item">
      <i class="fas fa-wallet"></i>
      <span>Wallet</span>
    </a>
    <a href="W-job-history.html" class="nav-item">
      <i class="fas fa-history"></i>
      <span>History</span>
    </a>
    <a href="W-settings.html" class="nav-item">
      <i class="fas fa-cog"></i>
      <span>Settings</span>
    </a>
  </nav>

  <!-- Modals -->
  
  <!-- Enhanced Work Done Modal -->
  <div class="modal-overlay" id="workDoneModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-clipboard-check"></i> Complete Job</h2>
        <button class="close-modal" data-modal="workDoneModal">&times;</button>
      </div>
      
      <div class="search-services">
        <input type="text" class="search-input" id="serviceSearch" placeholder="ðŸ” Search for services...">
      </div>
      
      <div id="serviceCategories">
        <!-- Service categories will be populated here -->
      </div>
      
      <div class="total-section">
        <div class="total-row">
          <span>Subtotal:</span>
          <span id="subtotalAmount">â‚¹0</span>
        </div>
        <div class="total-row">
          <span>Material Cost:</span>
          <span id="materialCost">â‚¹0</span>
        </div>
        <div class="total-row">
          <span>Transportation:</span>
          <span id="transportCost">â‚¹0</span>
        </div>
        <div class="total-row final">
          <span>Total Amount:</span>
          <span class="total-amount" id="totalAmount">â‚¹0</span>
        </div>
      </div>
      
      <div class="notes-section">
        <label for="jobNotes"><i class="fas fa-edit"></i> Additional Notes (visible to customer)</label>
        <textarea id="jobNotes" placeholder="Add any additional notes about the job, materials used, or special instructions..."></textarea>
      </div>
      
      <div class="modal-actions">
        <button class="btn btn-primary" id="submitCompletionBtn">
          <i class="fas fa-paper-plane"></i> Send Invoice to Customer
        </button>
        <button class="btn btn-outline" data-modal="workDoneModal">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- Already Assigned Modal -->
  <div class="modal-overlay" id="alreadyAssignedModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-exclamation-triangle"></i> Already Assigned</h2>
        <button class="close-modal" data-modal="alreadyAssignedModal">&times;</button>
      </div>
      <p style="margin: 20px 0; line-height: 1.6;">
        You already have an active job assignment. Please complete or cancel your current job before taking another assignment.
      </p>
      <div class="modal-actions">
        <button class="btn btn-primary" id="goToActiveJobBtn">
          <i class="fas fa-eye"></i> View Active Job
        </button>
        <button class="btn btn-outline" data-modal="alreadyAssignedModal">
          Close
        </button>
      </div>
    </div>
  </div>

  <!-- Reject Job Modal -->
  <div class="modal-overlay" id="rejectJobModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-times-circle"></i> Reject Job</h2>
        <button class="close-modal" data-modal="rejectJobModal">&times;</button>
      </div>
      <p style="margin: 20px 0; line-height: 1.6;">
        Please select a reason for rejecting this job (optional):
      </p>
      <div class="task-checklist">
        <label class="task-item">
          <input type="radio" name="rejectReason" value="too_far">
          <span class="task-label">Location is too far</span>
        </label>
        <label class="task-item">
          <input type="radio" name="rejectReason" value="unavailable">
          <span class="task-label">I'm unavailable at that time</span>
        </label>
        <label class="task-item">
          <input type="radio" name="rejectReason" value="not_my_expertise">
          <span class="task-label">Not my area of expertise</span>
        </label>
        <label class="task-item">
          <input type="radio" name="rejectReason" value="other">
          <span class="task-label">Other reason</span>
        </label>
      </div>
      <div class="modal-actions">
        <button class="btn btn-danger" id="confirmRejectBtn">
          <i class="fas fa-times"></i> Reject Job
        </button>
        <button class="btn btn-outline" data-modal="rejectJobModal">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <!-- Logout Modal -->
  <div class="modal-overlay" id="logoutModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-sign-out-alt"></i> Logout</h2>
        <button class="close-modal" data-modal="logoutModal">&times;</button>
      </div>
      <p style="margin: 20px 0; line-height: 1.6;">
        Are you sure you want to logout from your account?
      </p>
      <div class="modal-actions">
        <button class="btn btn-danger" id="confirmLogoutBtn">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
        <button class="btn btn-outline" data-modal="logoutModal">
          Cancel
        </button>
      </div>
    </div>
  </div>

  <script>
    // Dashboard State Management
    const dashboardState = {
      worker: {
        name: "Anil Sharma",
        service: "Master Plumber",
        location: "Kasargod, Kerala",
        rating: 4.8,
        reviews: 89,
        jobsCompleted: 48,
        earnings: 12500,
        available: true
      },
      
      // Job states: pending, assigned, in-progress, completed
      upcomingJobs: [
        {
          id: 1,
          title: "Emergency Pipe Leak Repair",
          client: "Rajesh Kumar",
          date: "2023-06-15T10:00:00",
          location: "MG Road, Kasargod",
          phone: "+91 98765 43210",
          status: "assigned",
          type: "right-now",
          tasks: [
            { id: 1, name: "Pipe Leak Repair", price: 300 },
            { id: 2, name: "Pipe Replacement (2m)", price: 300 }
          ]
        },
        {
          id: 2,
          title: "Bathroom Fitting Installation",
          client: "Meera Singh",
          date: "2023-06-17T14:30:00",
          location: "Beach Road, Kasargod",
          phone: "+91 98765 43211",
          status: "pending",
          type: "appointment",
          tasks: [
            { id: 3, name: "Bathroom Fitting Installation", price: 350 }
          ]
        },
        {
          id: 3,
          title: "Water Tank Cleaning",
          client: "Vikram Patel",
          date: "2023-06-18T11:00:00",
          location: "City Center, Kasargod",
          phone: "+91 98765 43212",
          status: "pending",
          type: "appointment",
          tasks: [
            { id: 4, name: "Water Tank Cleaning", price: 500 }
          ]
        }
      ],
      
      notifications: [
        {
          id: 101,
          jobId: 4,
          title: "Kitchen Sink Installation",
          client: "Priya Nair",
          date: "2023-06-16T09:00:00",
          location: "North Kasargod",
          phone: "+91 98765 43213",
          type: "right-now",
          time: "5 min ago",
          urgent: true
        },
        {
          id: 102,
          jobId: 5,
          title: "Complete Bathroom Plumbing",
          client: "Sanjay Kumar",
          date: "2023-06-19T15:00:00",
          location: "South Kasargod",
          phone: "+91 98765 43214",
          type: "appointment",
          time: "1 hour ago",
          urgent: false
        }
      ],
      
      // Plumber services database
      plumberServices: [
        {
          id: 1,
          category: "Leak Repair",
          name: "Pipe Leak Repair",
          description: "Repair of leaking pipes",
          price: 300,
          unit: "per leak"
        },
        {
          id: 2,
          category: "Leak Repair",
          name: "Joints/Gasket Leak Repair",
          description: "Repair of leaking joints or gaskets",
          price: 250,
          unit: "per joint"
        },
        {
          id: 3,
          category: "Leak Repair",
          name: "Valve Leak Repair",
          description: "Repair of leaking valves",
          price: 350,
          unit: "per valve"
        },
        {
          id: 4,
          category: "Pipe Work",
          name: "Pipe Installation",
          description: "Installation of new pipes",
          price: 150,
          unit: "per meter"
        },
        {
          id: 5,
          category: "Pipe Work",
          name: "Pipe Replacement",
          description: "Replacement of old/damaged pipes",
          price: 200,
          unit: "per meter"
        },
        {
          id: 6,
          category: "Pipe Work",
          name: "Pipe Alignment/Clearing",
          description: "Clearing and aligning blocked pipes",
          price: 400,
          unit: "per hour"
        },
        {
          id: 7,
          category: "Fixtures",
          name: "Tap Installation",
          description: "Installation of new taps",
          price: 200,
          unit: "per tap"
        },
        {
          id: 8,
          category: "Fixtures",
          name: "Tap Replacement",
          description: "Replacement of old/damaged taps",
          price: 250,
          unit: "per tap"
        },
        {
          id: 9,
          category: "Fixtures",
          name: "Bathroom Fitting Installation",
          description: "Installation of bathroom fixtures",
          price: 350,
          unit: "per fitting"
        },
        {
          id: 10,
          category: "Fixtures",
          name: "Kitchen Sink Installation",
          description: "Installation of kitchen sink",
          price: 400,
          unit: "per sink"
        },
        {
          id: 11,
          category: "Fixtures",
          name: "Wash Basin Installation",
          description: "Installation of wash basin",
          price: 350,
          unit: "per basin"
        },
        {
          id: 12,
          category: "Water Supply",
          name: "Water Motor/Pump Installation",
          description: "Installation of water pump/motor",
          price: 600,
          unit: "per pump"
        },
        {
          id: 13,
          category: "Water Supply",
          name: "Water Motor/Pump Repair",
          description: "Repair of water pump/motor",
          price: 450,
          unit: "per pump"
        },
        {
          id: 14,
          category: "Water Supply",
          name: "Water Tank Cleaning",
          description: "Complete cleaning of water tank",
          price: 500,
          unit: "per tank"
        },
        {
          id: 15,
          category: "Water Supply",
          name: "Water Tank Installation",
          description: "Installation of new water tank",
          price: 800,
          unit: "per tank"
        },
        {
          id: 16,
          category: "Drainage",
          name: "Drainage Pipe Installation",
          description: "Installation of drainage pipes",
          price: 200,
          unit: "per meter"
        },
        {
          id: 17,
          category: "Drainage",
          name: "Drain Blockage Clearing",
          description: "Clearing blocked drains",
          price: 350,
          unit: "per drain"
        },
        {
          id: 18,
          category: "Drainage",
          name: "Septic Tank Cleaning",
          description: "Complete septic tank cleaning",
          price: 1200,
          unit: "per tank"
        },
        {
          id: 19,
          category: "Heating Systems",
          name: "Geyser Installation",
          description: "Installation of water geyser",
          price: 700,
          unit: "per geyser"
        },
        {
          id: 20,
          category: "Heating Systems",
          name: "Geyser Repair",
          description: "Repair of water geyser",
          price: 500,
          unit: "per geyser"
        },
        {
          id: 21,
          category: "Bathroom",
          name: "Shower Installation",
          description: "Installation of shower system",
          price: 450,
          unit: "per shower"
        },
        {
          id: 22,
          category: "Bathroom",
          name: "WC/Toilet Installation",
          description: "Installation of toilet/WC",
          price: 900,
          unit: "per toilet"
        },
        {
          id: 23,
          category: "Bathroom",
          name: "WC/Toilet Repair",
          description: "Repair of toilet/WC",
          price: 400,
          unit: "per toilet"
        },
        {
          id: 24,
          category: "Kitchen",
          name: "Kitchen Pipe Installation",
          description: "Installation of kitchen pipes",
          price: 300,
          unit: "per job"
        },
        {
          id: 25,
          category: "Kitchen",
          name: "Dishwasher Connection",
          description: "Connection of dishwasher to plumbing",
          price: 350,
          unit: "per connection"
        },
        {
          id: 26,
          category: "Emergency",
          name: "Emergency Plumbing Service",
          description: "Urgent plumbing emergency",
          price: 600,
          unit: "per hour"
        },
        {
          id: 27,
          category: "Maintenance",
          name: "Regular Plumbing Checkup",
          description: "Complete plumbing system checkup",
          price: 300,
          unit: "per checkup"
        },
        {
          id: 28,
          category: "Maintenance",
          name: "Pressure Testing",
          description: "Water pressure testing",
          price: 250,
          unit: "per test"
        }
      ],
      
      activeJob: null,
      currentJobId: null,
      selectedServices: [],
      additionalCosts: {
        material: 0,
        transport: 0
      }
    };

    // DOM Elements
    const availabilityToggle = document.getElementById('availabilityToggle');
    const logoutBtn = document.getElementById('logoutBtn');
    const viewProfileBtn = document.getElementById('viewProfileBtn');
    const upcomingJobsList = document.getElementById('upcomingJobsList');
    const notificationsList = document.getElementById('notificationsList');
    const upcomingJobsCount = document.getElementById('upcomingJobsCount');
    const notificationsCount = document.getElementById('notificationsCount');
    const activeJobBanner = document.getElementById('activeJobBanner');
    const viewActiveJobBtn = document.getElementById('viewActiveJobBtn');
    const currentTime = document.getElementById('currentTime');
    const serviceSearch = document.getElementById('serviceSearch');
    const serviceCategories = document.getElementById('serviceCategories');

    // Initialize Dashboard
    document.addEventListener('DOMContentLoaded', function() {
      // Update time
      updateTime();
      setInterval(updateTime, 60000);
      
      // Load data from sessionStorage if available
      loadStateFromStorage();
      
      // Initialize UI
      renderUpcomingJobs();
      renderNotifications();
      updateCounts();
      checkActiveJob();
      
      // Set up event listeners
      setupEventListeners();
      
      // Set up modal handlers
      setupModalHandlers();
      
      // Set up service search
      serviceSearch.addEventListener('input', filterServices);
      
      // Simulate incoming notification (for demo)
      setTimeout(() => {
        if (dashboardState.worker.available) {
          simulateNewNotification();
        }
      }, 5000);
    });

    // Load state from sessionStorage
    function loadStateFromStorage() {
      const savedState = sessionStorage.getItem('workerDashboardState');
      if (savedState) {
        const parsed = JSON.parse(savedState);
        Object.assign(dashboardState, parsed);
      }
      
      // Set availability toggle
      availabilityToggle.checked = dashboardState.worker.available;
    }

    // Save state to sessionStorage
    function saveStateToStorage() {
      sessionStorage.setItem('workerDashboardState', JSON.stringify(dashboardState));
    }

    // Update current time
    function updateTime() {
      const now = new Date();
      const options = { 
        weekday: 'short', 
        month: 'short', 
        day: 'numeric',
        hour: '2-digit', 
        minute: '2-digit',
        hour12: true 
      };
      currentTime.textContent = now.toLocaleTimeString('en-US', options);
    }

    // Render upcoming jobs
    function renderUpcomingJobs() {
      upcomingJobsList.innerHTML = '';
      
      if (dashboardState.upcomingJobs.length === 0) {
        upcomingJobsList.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-calendar-plus"></i>
            <h3>No Upcoming Jobs</h3>
            <p>Stay available to receive work notifications</p>
          </div>
        `;
        return;
      }
      
      // Sort jobs: assigned/in-progress first, then by date
      const sortedJobs = [...dashboardState.upcomingJobs].sort((a, b) => {
        if (a.status === 'assigned' || a.status === 'in-progress') return -1;
        if (b.status === 'assigned' || b.status === 'in-progress') return 1;
        return new Date(a.date) - new Date(b.date);
      });
      
      sortedJobs.forEach(job => {
        const jobCard = createJobCard(job);
        upcomingJobsList.appendChild(jobCard);
      });
    }

    // Create job card element
    function createJobCard(job) {
      const card = document.createElement('div');
      card.className = `job-card ${job.status}`;
      card.dataset.jobId = job.id;
      
      const date = new Date(job.date);
      const formattedDate = date.toLocaleDateString('en-IN', {
        weekday: 'short',
        month: 'short',
        day: 'numeric'
      });
      const formattedTime = date.toLocaleTimeString('en-IN', {
        hour: '2-digit',
        minute: '2-digit'
      });
      
      let statusClass = 'status-pending';
      let statusText = 'Pending';
      
      switch (job.status) {
        case 'assigned':
          statusClass = 'status-assigned';
          statusText = 'Assigned';
          break;
        case 'in-progress':
          statusClass = 'status-in-progress';
          statusText = 'In Progress';
          break;
        case 'completed':
          statusClass = 'status-completed';
          statusText = 'Completed';
          break;
      }
      
      let assignButton = '';
      if (job.type === 'appointment' && job.status === 'pending') {
        assignButton = `<button class="btn btn-primary btn-sm assign-job" data-job-id="${job.id}">
          <i class="fas fa-check"></i> Assign
        </button>`;
      }
      
      let actionButtons = '';
      if (job.status === 'assigned' || job.status === 'in-progress') {
        actionButtons = `
          <button class="btn btn-success work-done" data-job-id="${job.id}">
            <i class="fas fa-check-circle"></i> Work Done
          </button>
        `;
      }
      
      card.innerHTML = `
        <div class="job-card-header">
          <div>
            <div class="job-title">${job.title}</div>
            <div class="job-client">
              <i class="fas fa-user"></i> ${job.client}
            </div>
          </div>
          <div class="job-status ${statusClass}">${statusText}</div>
        </div>
        
        <div class="job-details">
          <div class="detail-item">
            <i class="fas fa-clock"></i>
            <span>${formattedDate} at ${formattedTime}</span>
          </div>
          <div class="detail-item">
            <i class="fas fa-map-marker-alt"></i>
            <span>${job.location}</span>
          </div>
        </div>
        
        <div class="job-actions">
          <button class="btn btn-outline btn-icon call-client" data-phone="${job.phone}">
            <i class="fas fa-phone"></i>
          </button>
          <button class="btn btn-outline btn-icon navigate-to" data-location="${job.location}">
            <i class="fas fa-directions"></i>
          </button>
          ${assignButton}
          ${actionButtons}
        </div>
      `;
      
      return card;
    }

    // Render notifications
    function renderNotifications() {
      notificationsList.innerHTML = '';
      
      if (dashboardState.notifications.length === 0) {
        notificationsList.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-bell-slash"></i>
            <h3>No Notifications</h3>
            <p>New job requests will appear here when you're available</p>
          </div>
        `;
        return;
      }
      
      dashboardState.notifications.forEach(notification => {
        const notificationCard = createNotificationCard(notification);
        notificationsList.appendChild(notificationCard);
      });
    }

    // Create notification card
    function createNotificationCard(notification) {
      const card = document.createElement('div');
      card.className = `notification-card ${notification.urgent ? 'urgent' : ''} ${notification.type === 'appointment' ? 'appointment' : ''}`;
      card.dataset.notificationId = notification.id;
      
      const date = new Date(notification.date);
      const formattedDate = date.toLocaleDateString('en-IN', {
        weekday: 'short',
        month: 'short',
        day: 'numeric'
      });
      const formattedTime = date.toLocaleTimeString('en-IN', {
        hour: '2-digit',
        minute: '2-digit'
      });
      
      card.innerHTML = `
        <div class="notification-header">
          <div>
            <div class="job-title">${notification.title}</div>
            <div class="job-client">
              <i class="fas fa-user"></i> ${notification.client}
            </div>
          </div>
          <div class="notification-time">
            <i class="far fa-clock"></i> ${notification.time}
          </div>
        </div>
        
        <div class="job-details">
          <div class="detail-item">
            <i class="fas fa-clock"></i>
            <span>${formattedDate} at ${formattedTime}</span>
          </div>
          <div class="detail-item">
            <i class="fas fa-map-marker-alt"></i>
            <span>${notification.location}</span>
          </div>
        </div>
        
        <div class="notification-actions">
          <button class="btn btn-primary accept-job" data-notification-id="${notification.id}">
            <i class="fas fa-check"></i> Accept
          </button>
          <button class="btn btn-danger reject-job" data-notification-id="${notification.id}">
            <i class="fas fa-times"></i> Reject
          </button>
        </div>
      `;
      
      return card;
    }

    // Update job and notification counts
    function updateCounts() {
      upcomingJobsCount.textContent = dashboardState.upcomingJobs.length;
      notificationsCount.textContent = dashboardState.notifications.length;
    }

    // Check for active job and show banner
    function checkActiveJob() {
      const activeJob = dashboardState.upcomingJobs.find(job => 
        job.status === 'assigned' || job.status === 'in-progress'
      );
      
      dashboardState.activeJob = activeJob || null;
      
      if (dashboardState.activeJob) {
        activeJobBanner.style.display = 'flex';
      } else {
        activeJobBanner.style.display = 'none';
      }
    }

    // Setup event listeners
    function setupEventListeners() {
      // Availability toggle
      availabilityToggle.addEventListener('change', function() {
        dashboardState.worker.available = this.checked;
        saveStateToStorage();
        
        if (this.checked) {
          showToast('You are now available for new jobs', 'success');
        } else {
          showToast('You are now unavailable for new jobs', 'warning');
        }
      });
      
      // Logout button
      logoutBtn.addEventListener('click', () => {
        showModal('logoutModal');
      });
      
      // View profile button
      viewProfileBtn.addEventListener('click', () => {
        // In a real app, this would navigate to profile page
        showToast('Profile page would open here', 'info');
      });
      
      // View active job button
      viewActiveJobBtn.addEventListener('click', () => {
        if (dashboardState.activeJob) {
          // Scroll to the active job card
          const activeJobCard = document.querySelector(`.job-card[data-job-id="${dashboardState.activeJob.id}"]`);
          if (activeJobCard) {
            activeJobCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
            // Add highlight effect
            activeJobCard.style.animation = 'pulse 2s infinite';
            setTimeout(() => {
              activeJobCard.style.animation = '';
            }, 2000);
          }
        }
      });
      
      // Event delegation for job cards
      upcomingJobsList.addEventListener('click', handleJobCardClick);
      notificationsList.addEventListener('click', handleNotificationClick);
      
      // Confirm logout
      document.getElementById('confirmLogoutBtn').addEventListener('click', () => {
        showToast('Logged out successfully', 'success');
        setTimeout(() => {
          // Clear session storage and redirect
          sessionStorage.clear();
          window.location.href = 'index.html';
        }, 1500);
      });
      
      // Submit completion button
      document.getElementById('submitCompletionBtn').addEventListener('click', submitJobCompletion);
      
      // Go to active job button in modal
      document.getElementById('goToActiveJobBtn').addEventListener('click', () => {
        hideModal('alreadyAssignedModal');
        if (dashboardState.activeJob) {
          const activeJobCard = document.querySelector(`.job-card[data-job-id="${dashboardState.activeJob.id}"]`);
          if (activeJobCard) {
            activeJobCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        }
      });
      
      // Confirm reject button
      document.getElementById('confirmRejectBtn').addEventListener('click', confirmRejectJob);
    }

    // Handle job card button clicks
    function handleJobCardClick(event) {
      const target = event.target;
      const jobCard = target.closest('.job-card');
      if (!jobCard) return;
      
      const jobId = parseInt(jobCard.dataset.jobId);
      const job = dashboardState.upcomingJobs.find(j => j.id === jobId);
      
      if (!job) return;
      
      // Call client button
      if (target.closest('.call-client')) {
        const phone = target.closest('.call-client').dataset.phone;
        showToast(`Calling ${phone}`, 'info');
        // In a real app: window.location.href = `tel:${phone}`;
      }
      
      // Navigate button
      if (target.closest('.navigate-to')) {
        const location = target.closest('.navigate-to').dataset.location;
        showToast(`Opening navigation to ${location}`, 'info');
        // In a real app: window.open(`https://maps.google.com/?q=${encodeURIComponent(location)}`, '_blank');
      }
      
      // Assign job button (for appointments)
      if (target.closest('.assign-job')) {
        assignJob(jobId);
      }
      
      // Work done button
      if (target.closest('.work-done')) {
        showWorkDoneModal(jobId);
      }
    }

    // Handle notification button clicks
    function handleNotificationClick(event) {
      const target = event.target;
      const notificationCard = target.closest('.notification-card');
      if (!notificationCard) return;
      
      const notificationId = parseInt(notificationCard.dataset.notificationId);
      const notification = dashboardState.notifications.find(n => n.id === notificationId);
      
      if (!notification) return;
      
      // Accept job button
      if (target.closest('.accept-job')) {
        acceptNotification(notificationId);
      }
      
      // Reject job button
      if (target.closest('.reject-job')) {
        showRejectModal(notificationId);
      }
    }

    // Assign a job (mark as active)
    function assignJob(jobId) {
      // Check if there's already an active job
      if (dashboardState.activeJob) {
        showModal('alreadyAssignedModal');
        return;
      }
      
      const jobIndex = dashboardState.upcomingJobs.findIndex(j => j.id === jobId);
      if (jobIndex === -1) return;
      
      dashboardState.upcomingJobs[jobIndex].status = 'assigned';
      dashboardState.activeJob = dashboardState.upcomingJobs[jobIndex];
      
      saveStateToStorage();
      renderUpcomingJobs();
      checkActiveJob();
      showToast('Job assigned successfully', 'success');
    }

    // Accept a notification
    function acceptNotification(notificationId) {
      const notificationIndex = dashboardState.notifications.findIndex(n => n.id === notificationId);
      if (notificationIndex === -1) return;
      
      const notification = dashboardState.notifications[notificationIndex];
      
      // Check if there's already an active job
      if (dashboardState.activeJob && notification.type === 'right-now') {
        showModal('alreadyAssignedModal');
        return;
      }
      
      // Create a new job from notification
      const newJob = {
        id: notification.jobId,
        title: notification.title,
        client: notification.client,
        date: notification.date,
        location: notification.location,
        phone: notification.phone,
        status: notification.type === 'right-now' ? 'assigned' : 'pending',
        type: notification.type,
        tasks: generateTasksForJob(notification.title)
      };
      
      // Add to upcoming jobs
      dashboardState.upcomingJobs.push(newJob);
      
      // Remove from notifications
      dashboardState.notifications.splice(notificationIndex, 1);
      
      // If it's a right-now job, set as active
      if (notification.type === 'right-now') {
        dashboardState.activeJob = newJob;
      }
      
      saveStateToStorage();
      renderUpcomingJobs();
      renderNotifications();
      updateCounts();
      checkActiveJob();
      
      showToast('Job accepted successfully', 'success');
    }

    // Show enhanced work done modal with service menu
    function showWorkDoneModal(jobId) {
      dashboardState.currentJobId = jobId;
      dashboardState.selectedServices = [];
      dashboardState.additionalCosts = { material: 0, transport: 0 };
      
      const job = dashboardState.upcomingJobs.find(j => j.id === jobId);
      if (!job) return;
      
      // Clear previous content
      serviceCategories.innerHTML = '';
      document.getElementById('jobNotes').value = '';
      serviceSearch.value = '';
      
      // Group services by category
      const categories = {};
      dashboardState.plumberServices.forEach(service => {
        if (!categories[service.category]) {
          categories[service.category] = [];
        }
        categories[service.category].push(service);
      });
      
      // Create category sections
      let categoryIndex = 0;
      for (const [categoryName, services] of Object.entries(categories)) {
        const categoryDiv = document.createElement('div');
        categoryDiv.className = 'service-category';
        categoryDiv.dataset.category = categoryName;
        
        // Get category icon
        const categoryIcon = getCategoryIcon(categoryName);
        
        categoryDiv.innerHTML = `
          <div class="category-header" data-index="${categoryIndex}">
            <h3>
              <i class="fas ${categoryIcon} category-icon"></i>
              ${categoryName} (${services.length} services)
            </h3>
            <i class="fas fa-chevron-down category-toggle"></i>
          </div>
          <div class="service-list collapsed">
            ${services.map(service => `
              <div class="service-item" data-service-id="${service.id}">
                <input type="checkbox" class="service-checkbox" id="service-${service.id}">
                <div class="service-info">
                  <div class="service-name">${service.name}</div>
                  <div class="service-description">${service.description}</div>
                </div>
                <div class="quantity-control">
                  <button class="quantity-btn minus" data-service-id="${service.id}">-</button>
                  <input type="number" class="quantity-input" id="qty-${service.id}" value="1" min="1" max="10" data-service-id="${service.id}">
                  <button class="quantity-btn plus" data-service-id="${service.id}">+</button>
                </div>
                <div class="service-price">â‚¹${service.price}</div>
              </div>
            `).join('')}
          </div>
        `;
        
        serviceCategories.appendChild(categoryDiv);
        categoryIndex++;
      }
      
      // Add additional costs section
      const additionalCostsDiv = document.createElement('div');
      additionalCostsDiv.className = 'service-category';
      additionalCostsDiv.innerHTML = `
        <div class="category-header" data-index="${categoryIndex}">
          <h3>
            <i class="fas fa-money-bill-wave category-icon"></i>
            Additional Costs
          </h3>
          <i class="fas fa-chevron-down category-toggle collapsed"></i>
        </div>
        <div class="service-list collapsed">
          <div class="service-item">
            <div class="service-info">
              <div class="service-name">Material Cost</div>
              <div class="service-description">Cost of materials used (pipes, fittings, etc.)</div>
            </div>
            <div class="quantity-control">
              <input type="number" class="quantity-input" id="materialCostInput" value="0" min="0" step="50">
            </div>
            <div class="service-price" id="materialCostDisplay">â‚¹0</div>
          </div>
          <div class="service-item">
            <div class="service-info">
              <div class="service-name">Transportation Cost</div>
              <div class="service-description">Travel expenses to the job site</div>
            </div>
            <div class="quantity-control">
              <input type="number" class="quantity-input" id="transportCostInput" value="0" min="0" step="50">
            </div>
            <div class="service-price" id="transportCostDisplay">â‚¹0</div>
          </div>
        </div>
      `;
      
      serviceCategories.appendChild(additionalCostsDiv);
      
      // Set up event listeners for the modal
      setupWorkDoneModalListeners();
      
      // Initialize totals
      updateTotals();
      
      showModal('workDoneModal');
    }

    // Set up event listeners for work done modal
    function setupWorkDoneModalListeners() {
      // Category toggle
      document.querySelectorAll('.category-header').forEach(header => {
        header.addEventListener('click', function() {
          const index = this.dataset.index;
          const serviceList = this.nextElementSibling;
          const toggleIcon = this.querySelector('.category-toggle');
          
          serviceList.classList.toggle('collapsed');
          toggleIcon.classList.toggle('collapsed');
        });
      });
      
      // Service checkbox selection
      document.querySelectorAll('.service-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const serviceId = parseInt(this.id.replace('service-', ''));
          const serviceItem = this.closest('.service-item');
          const quantity = parseInt(document.getElementById(`qty-${serviceId}`).value);
          
          if (this.checked) {
            serviceItem.classList.add('selected');
            addServiceToSelection(serviceId, quantity);
          } else {
            serviceItem.classList.remove('selected');
            removeServiceFromSelection(serviceId);
          }
          
          updateTotals();
        });
      });
      
      // Quantity controls
      document.querySelectorAll('.quantity-btn').forEach(button => {
        button.addEventListener('click', function() {
          const serviceId = parseInt(this.dataset.serviceId);
          const input = document.getElementById(`qty-${serviceId}`);
          let value = parseInt(input.value);
          
          if (this.classList.contains('plus')) {
            value = Math.min(value + 1, 10);
          } else if (this.classList.contains('minus')) {
            value = Math.max(value - 1, 1);
          }
          
          input.value = value;
          
          // Update selection if service is selected
          const checkbox = document.getElementById(`service-${serviceId}`);
          if (checkbox.checked) {
            updateServiceQuantity(serviceId, value);
            updateTotals();
          }
        });
      });
      
      // Quantity input change
      document.querySelectorAll('.quantity-input').forEach(input => {
        if (!input.id.includes('CostInput')) {
          input.addEventListener('change', function() {
            const serviceId = parseInt(this.dataset.serviceId);
            let value = parseInt(this.value);
            
            // Validate
            if (isNaN(value) || value < 1) value = 1;
            if (value > 10) value = 10;
            this.value = value;
            
            // Update selection if service is selected
            const checkbox = document.getElementById(`service-${serviceId}`);
            if (checkbox && checkbox.checked) {
              updateServiceQuantity(serviceId, value);
              updateTotals();
            }
          });
        }
      });
      
      // Additional costs inputs
      document.getElementById('materialCostInput').addEventListener('input', function() {
        const value = parseInt(this.value) || 0;
        dashboardState.additionalCosts.material = value;
        document.getElementById('materialCostDisplay').textContent = `â‚¹${value}`;
        updateTotals();
      });
      
      document.getElementById('transportCostInput').addEventListener('input', function() {
        const value = parseInt(this.value) || 0;
        dashboardState.additionalCosts.transport = value;
        document.getElementById('transportCostDisplay').textContent = `â‚¹${value}`;
        updateTotals();
      });
    }

    // Add service to selection
    function addServiceToSelection(serviceId, quantity) {
      const service = dashboardState.plumberServices.find(s => s.id === serviceId);
      if (!service) return;
      
      // Check if already in selection
      const existingIndex = dashboardState.selectedServices.findIndex(s => s.id === serviceId);
      
      if (existingIndex > -1) {
        dashboardState.selectedServices[existingIndex].quantity = quantity;
      } else {
        dashboardState.selectedServices.push({
          id: service.id,
          name: service.name,
          price: service.price,
          quantity: quantity,
          total: service.price * quantity
        });
      }
    }

    // Remove service from selection
    function removeServiceFromSelection(serviceId) {
      const index = dashboardState.selectedServices.findIndex(s => s.id === serviceId);
      if (index > -1) {
        dashboardState.selectedServices.splice(index, 1);
      }
    }

    // Update service quantity
    function updateServiceQuantity(serviceId, quantity) {
      const serviceIndex = dashboardState.selectedServices.findIndex(s => s.id === serviceId);
      if (serviceIndex > -1) {
        const service = dashboardState.selectedServices[serviceIndex];
        service.quantity = quantity;
        service.total = service.price * quantity;
      }
    }

    // Update totals
    function updateTotals() {
      // Calculate subtotal
      const subtotal = dashboardState.selectedServices.reduce((sum, service) => sum + service.total, 0);
      
      // Calculate total
      const total = subtotal + dashboardState.additionalCosts.material + dashboardState.additionalCosts.transport;
      
      // Update display
      document.getElementById('subtotalAmount').textContent = `â‚¹${subtotal}`;
      document.getElementById('materialCost').textContent = `â‚¹${dashboardState.additionalCosts.material}`;
      document.getElementById('transportCost').textContent = `â‚¹${dashboardState.additionalCosts.transport}`;
      document.getElementById('totalAmount').textContent = `â‚¹${total}`;
    }

    // Filter services based on search
    function filterServices() {
      const searchTerm = serviceSearch.value.toLowerCase();
      
      document.querySelectorAll('.service-item').forEach(item => {
        const serviceName = item.querySelector('.service-name').textContent.toLowerCase();
        const serviceDesc = item.querySelector('.service-description').textContent.toLowerCase();
        
        if (searchTerm === '' || serviceName.includes(searchTerm) || serviceDesc.includes(searchTerm)) {
          item.style.display = 'flex';
          
          // Expand parent category if service matches search
          const category = item.closest('.service-category');
          const serviceList = category.querySelector('.service-list');
          const toggleIcon = category.querySelector('.category-toggle');
          
          if (searchTerm !== '') {
            serviceList.classList.remove('collapsed');
            toggleIcon.classList.remove('collapsed');
          }
        } else {
          item.style.display = 'none';
        }
      });
    }

    // Get icon for category
    function getCategoryIcon(categoryName) {
      const iconMap = {
        'Leak Repair': 'fa-tint',
        'Pipe Work': 'fa-pipe',
        'Fixtures': 'fa-wrench',
        'Water Supply': 'fa-water',
        'Drainage': 'fa-shower',
        'Heating Systems': 'fa-fire',
        'Bathroom': 'fa-bath',
        'Kitchen': 'fa-utensils',
        'Emergency': 'fa-exclamation-triangle',
        'Maintenance': 'fa-clipboard-check'
      };
      
      return iconMap[categoryName] || 'fa-tools';
    }

    // Submit job completion with service selection
    function submitJobCompletion() {
      const jobId = dashboardState.currentJobId;
      const jobIndex = dashboardState.upcomingJobs.findIndex(j => j.id === jobId);
      
      if (jobIndex === -1) return;
      
      // Get notes
      const notes = document.getElementById('jobNotes').value.trim();
      
      // Validate at least one service selected or notes
      if (dashboardState.selectedServices.length === 0 && notes === '') {
        showToast('Please select at least one service or add notes', 'warning');
        return;
      }
      
      // Calculate total
      const subtotal = dashboardState.selectedServices.reduce((sum, service) => sum + service.total, 0);
      const total = subtotal + dashboardState.additionalCosts.material + dashboardState.additionalCosts.transport;
      
      // Update job status
      dashboardState.upcomingJobs[jobIndex].status = 'completed';
      dashboardState.upcomingJobs[jobIndex].completedServices = [...dashboardState.selectedServices];
      dashboardState.upcomingJobs[jobIndex].additionalCosts = {...dashboardState.additionalCosts};
      dashboardState.upcomingJobs[jobIndex].totalAmount = total;
      dashboardState.upcomingJobs[jobIndex].notes = notes;
      dashboardState.upcomingJobs[jobIndex].completionDate = new Date().toISOString();
      
      dashboardState.activeJob = null;
      
      // Update worker earnings
      dashboardState.worker.earnings += total;
      dashboardState.worker.jobsCompleted += 1;
      
      // Create invoice for customer
      const invoice = {
        jobId: jobId,
        client: dashboardState.upcomingJobs[jobIndex].client,
        date: new Date().toLocaleDateString('en-IN'),
        services: dashboardState.selectedServices,
        additionalCosts: dashboardState.additionalCosts,
        subtotal: subtotal,
        total: total,
        notes: notes,
        worker: dashboardState.worker.name,
        workerRating: dashboardState.worker.rating
      };
      
      saveStateToStorage();
      renderUpcomingJobs();
      checkActiveJob();
      hideModal('workDoneModal');
      
      // Show success message with invoice summary
      let serviceSummary = dashboardState.selectedServices.map(s => 
        `${s.name} (${s.quantity} Ã— â‚¹${s.price})`
      ).join(', ');
      
      if (dashboardState.additionalCosts.material > 0) {
        serviceSummary += `, Materials: â‚¹${dashboardState.additionalCosts.material}`;
      }
      
      if (dashboardState.additionalCosts.transport > 0) {
        serviceSummary += `, Transport: â‚¹${dashboardState.additionalCosts.transport}`;
      }
      
      showToast(`Job completed successfully! Invoice of â‚¹${total} sent to customer. Services: ${serviceSummary}`, 'success');
      
      // Simulate sending invoice to customer
      setTimeout(() => {
        showToast('ðŸ“„ Invoice has been sent to the customer for approval', 'info');
      }, 1000);
    }

    // Show reject modal
    function showRejectModal(notificationId) {
      dashboardState.currentNotificationId = notificationId;
      showModal('rejectJobModal');
    }

    // Confirm reject job
    function confirmRejectJob() {
      const notificationId = dashboardState.currentNotificationId;
      const notificationIndex = dashboardState.notifications.findIndex(n => n.id === notificationId);
      
      if (notificationIndex === -1) return;
      
      // Get rejection reason
      const selectedReason = document.querySelector('input[name="rejectReason"]:checked');
      const reason = selectedReason ? selectedReason.value : 'no_reason';
      
      // Remove notification
      dashboardState.notifications.splice(notificationIndex, 1);
      
      saveStateToStorage();
      renderNotifications();
      updateCounts();
      hideModal('rejectJobModal');
      
      showToast('Job rejected', 'info');
    }

    // Generate tasks for a job (simulated)
    function generateTasksForJob(jobTitle) {
      // This is a simplified simulation
      const taskTemplates = {
        'Kitchen Sink Installation': [
          { id: 5, name: 'Kitchen Sink Installation', price: 350 },
          { id: 6, name: 'Pipe Connection', price: 150 }
        ],
        'Complete Bathroom Plumbing': [
          { id: 7, name: 'Bathroom Fitting Installation', price: 350 },
          { id: 8, name: 'Pipe Installation (3m)', price: 450 },
          { id: 9, name: 'Drainage Setup', price: 250 }
        ]
      };
      
      for (const [key, tasks] of Object.entries(taskTemplates)) {
        if (jobTitle.includes(key.split(' ')[0])) {
          return tasks;
        }
      }
      
      // Default tasks
      return [
        { id: 10, name: 'General Plumbing Work', price: 300 }
      ];
    }

    // Simulate new notification (for demo)
    function simulateNewNotification() {
      if (!dashboardState.worker.available) return;
      
      const notificationTypes = [
        {
          id: Date.now(),
          jobId: Date.now() + 100,
          title: "Emergency Water Leak Repair",
          client: "Amit Verma",
          date: new Date(Date.now() + 3600000).toISOString(),
          location: "Central Kasargod",
          phone: "+91 98765 43215",
          type: "right-now",
          time: "Just now",
          urgent: true
        },
        {
          id: Date.now() + 1,
          jobId: Date.now() + 200,
          title: "Water Purifier Installation",
          client: "Neha Sharma",
          date: new Date(Date.now() + 86400000).toISOString(),
          location: "West Kasargod",
          phone: "+91 98765 43216",
          type: "appointment",
          time: "Just now",
          urgent: false
        }
      ];
      
      const randomNotification = notificationTypes[Math.floor(Math.random() * notificationTypes.length)];
      dashboardState.notifications.push(randomNotification);
      
      saveStateToStorage();
      renderNotifications();
      updateCounts();
      
      // Show alert for urgent notification
      if (randomNotification.urgent) {
        showToast(`ðŸ”” New urgent job: ${randomNotification.title}`, 'info');
      }
    }

    // Modal handlers
    function setupModalHandlers() {
      // Close modal buttons
      document.querySelectorAll('.close-modal, .btn-outline[data-modal]').forEach(button => {
        button.addEventListener('click', function() {
          const modalId = this.dataset.modal;
          hideModal(modalId);
        });
      });
      
      // Close modal when clicking outside
      document.querySelectorAll('.modal-overlay').forEach(modal => {
        modal.addEventListener('click', function(e) {
          if (e.target === this) {
            hideModal(this.id);
          }
        });
      });
      
      // Close modal with Escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          document.querySelectorAll('.modal-overlay').forEach(modal => {
            if (modal.style.display === 'flex') {
              hideModal(modal.id);
            }
          });
        }
      });
    }

    // Show modal
    function showModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
      }
    }

    // Hide modal
    function hideModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
      }
    }

    // Show toast notification
    function showToast(message, type = 'info') {
      // Remove existing toasts
      const existingToasts = document.querySelectorAll('.toast');
      existingToasts.forEach(toast => toast.remove());
      
      // Create toast element
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.innerHTML = `
        <div class="toast-content">
          <span>${message}</span>
        </div>
      `;
      
      // Add styles for toast
      toast.style.position = 'fixed';
      toast.style.bottom = '80px';
      toast.style.right = '20px';
      toast.style.background = type === 'success' ? '#10b981' : 
                               type === 'warning' ? '#f59e0b' : 
                               type === 'danger' ? '#ef4444' : '#3b82f6';
      toast.style.color = 'white';
      toast.style.padding = '12px 20px';
      toast.style.borderRadius = '8px';
      toast.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)';
      toast.style.zIndex = '1000';
      toast.style.animation = 'slideUp 0.3s ease';
      toast.style.fontSize = '14px';
      toast.style.maxWidth = '300px';
      
      document.body.appendChild(toast);
      
      // Remove toast after 3 seconds
      setTimeout(() => {
        toast.style.animation = 'slideUp 0.3s ease reverse';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }
  </script>
</body>
</html>